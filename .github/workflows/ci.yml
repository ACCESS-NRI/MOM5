name: CI
on:
  pull_request:
jobs:
  build-and-test:
    name: Build and Test
    strategy:
      fail-fast: false
      matrix:
        values:
          - manifest: .github/build-ci/templates/basic.spack.yaml.j2
            compiler: .github/build-ci/compilers/compiler.spack.yaml
          - manifest: .github/build-ci/templates/access-om2.spack.yaml.j2
            compiler: .github/build-ci/compilers/compiler.spack.yaml
          - manifest: .github/build-ci/templates/access-om2.spack.yaml.j2
            compiler: .github/build-ci/compilers/compiler.spack.yaml

          - manifest: .github/build-ci/templates/access-esm1p5.spack.yaml
            compiler: ''
          - manifest: .github/build-ci/templates/access-esm1p5.spack.yaml
            compiler: ''
          - manifest: .github/build-ci/templates/access-esm1p6.spack.yaml.j2
            compiler: ''
          - manifest: .github/build-ci/templates/access-esm1p6.spack.yaml.j2
            compiler: ''
          - manifest: .github/build-ci/templates/access-esm1p6.spack.yaml.j2
            compiler: ''
    uses: access-nri/build-ci/.github/workflows/ci.yml@build-ci-2.0
    with:
      spack-manifest-path: ${{ matrix.values.manifest }}
      spack-compiler-manifest-path: ${{ matrix.values.compiler }}
      spack-packages-ref: convert-private-repos-from-ssh-to-https-clone
    secrets:
      spack-install-command-pat: ${{ secrets.TEST_SPACK_INSTALL_COMMAND_PAT }}
